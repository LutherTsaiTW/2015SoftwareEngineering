<!DOCTYPE HTML>
<html>

<head>
    <title>Add Project</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" href="../css/w3.css">
    <link rel="stylesheet" href="../css/dateRangePicker.css">
    <script type="text/javascript" src="../js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="../js/moment-with-locales.js"></script>
    <script type="text/javascript" src="../js/jquery.daterangepicker.js"></script>
</head>
<style>
a:link {
    color: lightgrey;
    background-color: transparent;
    text-decoration: none;
}

a:visited {
    color: lightgrey;
    background-color: transparent;
    text-decoration: none;
}

a:hover {
    color: white;
    background-color: transparent;
    text-decoration: underline;
}

a:active {
    color: white;
    background-color: transparent;
    text-decoration: underline;
}

.title {
    color: white;
    text-align: center;
}

.titleText {
    background-color: grey;
    border-radius: 5px
}

.fastAccount {
    background-color: grey;
    border-radius: 5px;
    float: right;
}

.fastAccountBlock {
    width: 10;
    float: right;
}

.formBlock {
    background-color: rgb(40, 40, 40);
    border-radius: 15px;
    width: 400;
}
</style>
<script>
function submitAddProject() {
    $.post("projectCheck.php", {
            Company: $("#project_company").val(),
            Project_Name: $("#project_name").val(),
            ProjectID: 0
        })
        .done(function(data) {
            var check_result = $.parseJSON(data);
            if (check_result.SUCCESS == "1") {
                $.post("addProject.php", {
                    Company: $("#project_company").val(),
                    Name: $("#project_name").val(),
                    StartTime: $("#startTime").val(),
                    EndTime: $("#endTime").val(),
                    Status: $("#status").val(),
                    Description: $("#project_des").val()
                }).done(function(parseData) {
                    var response = $.parseJSON(parseData);
                    if (response.SUCCESS == 1) {
                        window.location.href = "projectList.html";
                    } else {
                        alert("Add Project Failure");
                    }
                });;
            } else {
                alert("Please check if the project is exist!!!");
            }
        });
}
</script>

<body class="w3-container" style="background-color:rgb(60, 60, 60)">
    <br/>
    <div class="w3-row ">
        <div style="float:left">
            <img src="../imgs/ptsIcon.png" alt="ICON" width="100" Height="30" />
        </div>
        <div class="w3-container fastAccount">
            <a href="../logout.php" style="color:white">Logout</a>
        </div>
        <div class="w3-container" id="userName" style="float:right;color:white;font-size:18">
            Welcome!
        </div>
        <script type="text/javascript" src="../js/getUser.js"></script>
    </div>
    <div class="w3-row title">
        <h1 class="titleText">
                Add Project
            </h1>
    </div>
    <div class="w3-row" align="center">
        <div class="w3-col">
            <form action="javascript:submitAddProject();">
                <br>
                <div class="w3-row formBlock" style>
                    <div class="w3-col m4">
                        <p/>
                    </div>
                    <div class="w3-third" align="left">
                        <br>
                        <font color="white">Name:</font>
                        <br>
                        <input id="project_name" type="text" name="Name" autofocus required style="border-radius: 3px" placeholder="Enter a Project Name" />
                        <br>
                        <font color="white">Company:</font>
                        <br>
                        <input id="project_company" type="text" name="Company" autofocus required style="border-radius: 3px" placeholder="Enter the company" />
                        <br>
                        <font color="white">Start Time:</font>
                        <br>
                        <div id="date_picker">
                            <input id="startTime" type="datetime" name="StartTime" required style="border-radius: 3px" value="" />
                            <br>
                            <font color="white">End Time:</font>
                            <br>
                            <input id="endTime" type="datetime" name="EndTime" required style="border-radius: 3px" value="" />
                        </div>
                        <script>
                        function getExceptDays() {
                            var startTimeObj = document.getElementById("startTime");
                            var startTime = startTimeObj.value;
                            var endTimeObj = document.getElementById("endTime");
                            var endTime = endTimeObj.value;
                            var days = document.getElementById("days");
                            startTime = moment(startTime, "YYYY-MM-DD HH:mm:ss");
                            endTime = moment(endTime, "YYYY-MM-DD HH:mm:ss");
                            var diffDays = endTime.diff(startTime, 'days') + 1;
                            days.innerHTML = "Except: " + diffDays.toString() + " Days";
                        }

                        $("#date_picker").dateRangePicker({
                            separator: 'to',
                            format: 'YYYY-MM-DD HH:mm:ss',
                            getValue: function() {
                                if ($('#startTime').val() && $('#endTime').val())
                                    return $('#startTime').val() + ' to ' + $('#endTime').val();
                                else
                                    return '';
                            },
                            setValue: function(s, s1, s2) {
                                $('#startTime').val(s1);
                                $('#endTime').val(s2);
                                getExceptDays();
                            }
                        });
                        </script>
                        <font color="gray"><span id="days">Expect:</span></font>
                        <script>
                        $(document).ready(function() {
                            getExceptDays();
                            var startTimeObj = document.getElementById("startTime");
                            var endTimeObj = document.getElementById("endTime");
                            startTimeObj.onchange = getExceptDays;
                            endTimeObj.onchange = getExceptDays;
                        });
                        </script>
                        <br>
                        <font color="white">Status:</font>
                        <br>
                        <select name="Status" id="status">
                            <option value="0">Close</option>
                            <option value="1">Open</option>
                            <option value="2">Terminated</option>
                        </select>
                        <br>
                        <font color="white">Description:</font>
                        <br>
                        <textarea id="project_des" name="Description" cols="40" rows="5" required></textarea>
                        <br>
                        <input id="submitBtn" type="submit" name="submit" value="Add" class="w3-teal">
                        <input type="button" name="exit" value="Cancel" class="w3-teal" onclick="location.href='projectList.html';">
                        <br>
                        <br>
                        <br>
                    </div>
                </div>
            </form>
        </div>
    </div>
</body>

</html>
